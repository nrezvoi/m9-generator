'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _lodash = require('lodash');

exports.default = matterInterpolate;


var VARIABLE_PATTERN = '\\$\\{([^}]+)\\}';
var VARIABLE_REGEXP = new RegExp(VARIABLE_PATTERN, 'g');
var SINGLE_VARIABLE_REGEXP = new RegExp('^' + VARIABLE_PATTERN + '$');

function matterInterpolate(input, metadata) {
  var processFn = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (v) {
    return v;
  };

  var result = input.match(SINGLE_VARIABLE_REGEXP);
  if (result) {
    var variable = result[1];
    return interpolateOne(variable, metadata, processFn);
  }

  return input.replace(VARIABLE_REGEXP, function (match, variable) {
    return interpolateOne(variable, metadata, processFn);
  });
}

function interpolateOne(variable, object, processFn) {
  return processFn(resolve(variable, object));
}

function resolve(path, object) {
  var value = (0, _lodash.get)(object, path);
  if (value === undefined) {
    throw new Error('Cannot resolve data path: ' + JSON.stringify({
      path: path,
      object: object
    }, null, 2));
  }

  return value;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvbWF0dGVyLWludGVycG9sYXRlLmpzIl0sIm5hbWVzIjpbIm1hdHRlckludGVycG9sYXRlIiwiVkFSSUFCTEVfUEFUVEVSTiIsIlZBUklBQkxFX1JFR0VYUCIsIlJlZ0V4cCIsIlNJTkdMRV9WQVJJQUJMRV9SRUdFWFAiLCJpbnB1dCIsIm1ldGFkYXRhIiwicHJvY2Vzc0ZuIiwidiIsInJlc3VsdCIsIm1hdGNoIiwidmFyaWFibGUiLCJpbnRlcnBvbGF0ZU9uZSIsInJlcGxhY2UiLCJvYmplY3QiLCJyZXNvbHZlIiwicGF0aCIsInZhbHVlIiwidW5kZWZpbmVkIiwiRXJyb3IiLCJKU09OIiwic3RyaW5naWZ5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTs7a0JBQ2VBLGlCOzs7QUFFZixJQUFNQyxtQkFBbUIsa0JBQXpCO0FBQ0EsSUFBTUMsa0JBQWtCLElBQUlDLE1BQUosQ0FBV0YsZ0JBQVgsRUFBNkIsR0FBN0IsQ0FBeEI7QUFDQSxJQUFNRyx5QkFBeUIsSUFBSUQsTUFBSixPQUFlRixnQkFBZixPQUEvQjs7QUFFQSxTQUFTRCxpQkFBVCxDQUE0QkssS0FBNUIsRUFBbUNDLFFBQW5DLEVBQWlFO0FBQUEsTUFBcEJDLFNBQW9CLHVFQUFSO0FBQUEsV0FBS0MsQ0FBTDtBQUFBLEdBQVE7O0FBQy9ELE1BQUlDLFNBQVNKLE1BQU1LLEtBQU4sQ0FBWU4sc0JBQVosQ0FBYjtBQUNBLE1BQUlLLE1BQUosRUFBWTtBQUNWLFFBQU1FLFdBQVdGLE9BQU8sQ0FBUCxDQUFqQjtBQUNBLFdBQU9HLGVBQWVELFFBQWYsRUFBeUJMLFFBQXpCLEVBQW1DQyxTQUFuQyxDQUFQO0FBQ0Q7O0FBRUQsU0FBT0YsTUFBTVEsT0FBTixDQUFjWCxlQUFkLEVBQStCLFVBQUNRLEtBQUQsRUFBUUMsUUFBUjtBQUFBLFdBQ3BDQyxlQUFlRCxRQUFmLEVBQXlCTCxRQUF6QixFQUFtQ0MsU0FBbkMsQ0FEb0M7QUFBQSxHQUEvQixDQUFQO0FBRUQ7O0FBRUQsU0FBU0ssY0FBVCxDQUF5QkQsUUFBekIsRUFBbUNHLE1BQW5DLEVBQTJDUCxTQUEzQyxFQUFzRDtBQUNwRCxTQUFPQSxVQUFVUSxRQUFRSixRQUFSLEVBQWtCRyxNQUFsQixDQUFWLENBQVA7QUFDRDs7QUFFRCxTQUFTQyxPQUFULENBQWtCQyxJQUFsQixFQUF3QkYsTUFBeEIsRUFBZ0M7QUFDOUIsTUFBTUcsUUFBUSxpQkFBSUgsTUFBSixFQUFZRSxJQUFaLENBQWQ7QUFDQSxNQUFJQyxVQUFVQyxTQUFkLEVBQXlCO0FBQ3ZCLFVBQU0sSUFBSUMsS0FBSixDQUFVLCtCQUErQkMsS0FBS0MsU0FBTCxDQUFlO0FBQzVETCxnQkFENEQ7QUFFNURGO0FBRjRELEtBQWYsRUFHNUMsSUFINEMsRUFHdEMsQ0FIc0MsQ0FBekMsQ0FBTjtBQUlEOztBQUVELFNBQU9HLEtBQVA7QUFDRCIsImZpbGUiOiJtYXR0ZXItaW50ZXJwb2xhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXQgfSBmcm9tICdsb2Rhc2gnXG5leHBvcnQgZGVmYXVsdCBtYXR0ZXJJbnRlcnBvbGF0ZVxuXG5jb25zdCBWQVJJQUJMRV9QQVRURVJOID0gJ1xcXFwkXFxcXHsoW159XSspXFxcXH0nXG5jb25zdCBWQVJJQUJMRV9SRUdFWFAgPSBuZXcgUmVnRXhwKFZBUklBQkxFX1BBVFRFUk4sICdnJylcbmNvbnN0IFNJTkdMRV9WQVJJQUJMRV9SRUdFWFAgPSBuZXcgUmVnRXhwKGBeJHtWQVJJQUJMRV9QQVRURVJOfSRgKVxuXG5mdW5jdGlvbiBtYXR0ZXJJbnRlcnBvbGF0ZSAoaW5wdXQsIG1ldGFkYXRhLCBwcm9jZXNzRm4gPSB2ID0+IHYpIHtcbiAgbGV0IHJlc3VsdCA9IGlucHV0Lm1hdGNoKFNJTkdMRV9WQVJJQUJMRV9SRUdFWFApXG4gIGlmIChyZXN1bHQpIHtcbiAgICBjb25zdCB2YXJpYWJsZSA9IHJlc3VsdFsxXVxuICAgIHJldHVybiBpbnRlcnBvbGF0ZU9uZSh2YXJpYWJsZSwgbWV0YWRhdGEsIHByb2Nlc3NGbilcbiAgfVxuXG4gIHJldHVybiBpbnB1dC5yZXBsYWNlKFZBUklBQkxFX1JFR0VYUCwgKG1hdGNoLCB2YXJpYWJsZSkgPT5cbiAgICBpbnRlcnBvbGF0ZU9uZSh2YXJpYWJsZSwgbWV0YWRhdGEsIHByb2Nlc3NGbikpXG59XG5cbmZ1bmN0aW9uIGludGVycG9sYXRlT25lICh2YXJpYWJsZSwgb2JqZWN0LCBwcm9jZXNzRm4pIHtcbiAgcmV0dXJuIHByb2Nlc3NGbihyZXNvbHZlKHZhcmlhYmxlLCBvYmplY3QpKVxufVxuXG5mdW5jdGlvbiByZXNvbHZlIChwYXRoLCBvYmplY3QpIHtcbiAgY29uc3QgdmFsdWUgPSBnZXQob2JqZWN0LCBwYXRoKVxuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHJlc29sdmUgZGF0YSBwYXRoOiAnICsgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgcGF0aCxcbiAgICAgIG9iamVjdFxuICAgIH0sIG51bGwsIDIpKVxuICB9XG5cbiAgcmV0dXJuIHZhbHVlXG59XG4iXX0=