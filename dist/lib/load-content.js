'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _requireDir = require('require-dir');

var _requireDir2 = _interopRequireDefault(_requireDir);

var _config = require('../config');

var _config2 = _interopRequireDefault(_config);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = loadContent;


function loadContent(options) {
  var directory = options.directory,
      transformer = options.transformer;


  var staticDir = _path2.default.join(directory, 'static');
  var dynamicDir = _path2.default.join(directory, 'dynamic');

  var content = loadJsonContent(staticDir);
  if (transformer) transformContent(content, transformer);
  runAugmentersFromDir(dynamicDir, content);

  return content;
}

function loadJsonContent(dir) {
  return (0, _requireDir2.default)(dir);
}

function runAugmentersFromDir(dir, content) {
  var augmenters = (0, _requireDir2.default)(dir);
  Object.keys(augmenters).forEach(function (contentType) {
    var augment = augmenters[contentType];
    var entities = content[contentType];

    if (!entities) {
      content[contentType] = augment({}, content, _config2.default);
      return;
    }

    if (!Array.isArray(entities)) {
      content[contentType] = augment(entities, content, _config2.default);
      return;
    }

    content[contentType] = entities.map(function (entity) {
      return augment(entity, content, _config2.default);
    });
  });
}

function transformContent(content, transformerName) {
  var transformerFn = transformerByName(transformerName);
  transformerFn(content);
}

function transformerByName(transformerName) {
  try {
    return require('./content-transformers/' + transformerName);
  } catch (error) {
    throw new Error('Unsupported transformer "' + transformerName + '"');
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvbG9hZC1jb250ZW50LmpzIl0sIm5hbWVzIjpbImxvYWRDb250ZW50Iiwib3B0aW9ucyIsImRpcmVjdG9yeSIsInRyYW5zZm9ybWVyIiwic3RhdGljRGlyIiwicGF0aCIsImpvaW4iLCJkeW5hbWljRGlyIiwiY29udGVudCIsImxvYWRKc29uQ29udGVudCIsInRyYW5zZm9ybUNvbnRlbnQiLCJydW5BdWdtZW50ZXJzRnJvbURpciIsImRpciIsImF1Z21lbnRlcnMiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsImF1Z21lbnQiLCJjb250ZW50VHlwZSIsImVudGl0aWVzIiwiY29uZmlnIiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwiZW50aXR5IiwidHJhbnNmb3JtZXJOYW1lIiwidHJhbnNmb3JtZXJGbiIsInRyYW5zZm9ybWVyQnlOYW1lIiwicmVxdWlyZSIsImVycm9yIiwiRXJyb3IiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7O2tCQUVlQSxXOzs7QUFFZixTQUFTQSxXQUFULENBQXNCQyxPQUF0QixFQUErQjtBQUFBLE1BRTNCQyxTQUYyQixHQUl6QkQsT0FKeUIsQ0FFM0JDLFNBRjJCO0FBQUEsTUFHM0JDLFdBSDJCLEdBSXpCRixPQUp5QixDQUczQkUsV0FIMkI7OztBQU03QixNQUFNQyxZQUFZQyxlQUFLQyxJQUFMLENBQVVKLFNBQVYsRUFBcUIsUUFBckIsQ0FBbEI7QUFDQSxNQUFNSyxhQUFhRixlQUFLQyxJQUFMLENBQVVKLFNBQVYsRUFBcUIsU0FBckIsQ0FBbkI7O0FBRUEsTUFBTU0sVUFBVUMsZ0JBQWdCTCxTQUFoQixDQUFoQjtBQUNBLE1BQUlELFdBQUosRUFBaUJPLGlCQUFpQkYsT0FBakIsRUFBMEJMLFdBQTFCO0FBQ2pCUSx1QkFBcUJKLFVBQXJCLEVBQWlDQyxPQUFqQzs7QUFFQSxTQUFPQSxPQUFQO0FBQ0Q7O0FBRUQsU0FBU0MsZUFBVCxDQUEwQkcsR0FBMUIsRUFBK0I7QUFDN0IsU0FBTywwQkFBV0EsR0FBWCxDQUFQO0FBQ0Q7O0FBRUQsU0FBU0Qsb0JBQVQsQ0FBK0JDLEdBQS9CLEVBQW9DSixPQUFwQyxFQUE2QztBQUMzQyxNQUFNSyxhQUFhLDBCQUFXRCxHQUFYLENBQW5CO0FBQ0FFLFNBQU9DLElBQVAsQ0FBWUYsVUFBWixFQUF3QkcsT0FBeEIsQ0FBZ0MsdUJBQWU7QUFDN0MsUUFBTUMsVUFBVUosV0FBV0ssV0FBWCxDQUFoQjtBQUNBLFFBQU1DLFdBQVdYLFFBQVFVLFdBQVIsQ0FBakI7O0FBRUEsUUFBSSxDQUFDQyxRQUFMLEVBQWU7QUFDYlgsY0FBUVUsV0FBUixJQUF1QkQsUUFBUSxFQUFSLEVBQVlULE9BQVosRUFBcUJZLGdCQUFyQixDQUF2QjtBQUNBO0FBQ0Q7O0FBRUQsUUFBSSxDQUFDQyxNQUFNQyxPQUFOLENBQWNILFFBQWQsQ0FBTCxFQUE4QjtBQUM1QlgsY0FBUVUsV0FBUixJQUF1QkQsUUFBUUUsUUFBUixFQUFrQlgsT0FBbEIsRUFBMkJZLGdCQUEzQixDQUF2QjtBQUNBO0FBQ0Q7O0FBRURaLFlBQVFVLFdBQVIsSUFBdUJDLFNBQVNJLEdBQVQsQ0FBYTtBQUFBLGFBQVVOLFFBQVFPLE1BQVIsRUFBZ0JoQixPQUFoQixFQUF5QlksZ0JBQXpCLENBQVY7QUFBQSxLQUFiLENBQXZCO0FBQ0QsR0FmRDtBQWdCRDs7QUFFRCxTQUFTVixnQkFBVCxDQUEyQkYsT0FBM0IsRUFBb0NpQixlQUFwQyxFQUFxRDtBQUNuRCxNQUFNQyxnQkFBZ0JDLGtCQUFrQkYsZUFBbEIsQ0FBdEI7QUFDQUMsZ0JBQWNsQixPQUFkO0FBQ0Q7O0FBRUQsU0FBU21CLGlCQUFULENBQTRCRixlQUE1QixFQUE2QztBQUMzQyxNQUFJO0FBQ0YsV0FBT0csb0NBQWtDSCxlQUFsQyxDQUFQO0FBQ0QsR0FGRCxDQUVFLE9BQU9JLEtBQVAsRUFBYztBQUNkLFVBQU0sSUFBSUMsS0FBSiwrQkFBc0NMLGVBQXRDLE9BQU47QUFDRDtBQUNGIiwiZmlsZSI6ImxvYWQtY29udGVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgcmVxdWlyZURpciBmcm9tICdyZXF1aXJlLWRpcidcbmltcG9ydCBjb25maWcgZnJvbSAnLi4vY29uZmlnJ1xuXG5leHBvcnQgZGVmYXVsdCBsb2FkQ29udGVudFxuXG5mdW5jdGlvbiBsb2FkQ29udGVudCAob3B0aW9ucykge1xuICBjb25zdCB7XG4gICAgZGlyZWN0b3J5LFxuICAgIHRyYW5zZm9ybWVyXG4gIH0gPSBvcHRpb25zXG5cbiAgY29uc3Qgc3RhdGljRGlyID0gcGF0aC5qb2luKGRpcmVjdG9yeSwgJ3N0YXRpYycpXG4gIGNvbnN0IGR5bmFtaWNEaXIgPSBwYXRoLmpvaW4oZGlyZWN0b3J5LCAnZHluYW1pYycpXG5cbiAgY29uc3QgY29udGVudCA9IGxvYWRKc29uQ29udGVudChzdGF0aWNEaXIpXG4gIGlmICh0cmFuc2Zvcm1lcikgdHJhbnNmb3JtQ29udGVudChjb250ZW50LCB0cmFuc2Zvcm1lcilcbiAgcnVuQXVnbWVudGVyc0Zyb21EaXIoZHluYW1pY0RpciwgY29udGVudClcblxuICByZXR1cm4gY29udGVudFxufVxuXG5mdW5jdGlvbiBsb2FkSnNvbkNvbnRlbnQgKGRpcikge1xuICByZXR1cm4gcmVxdWlyZURpcihkaXIpXG59XG5cbmZ1bmN0aW9uIHJ1bkF1Z21lbnRlcnNGcm9tRGlyIChkaXIsIGNvbnRlbnQpIHtcbiAgY29uc3QgYXVnbWVudGVycyA9IHJlcXVpcmVEaXIoZGlyKVxuICBPYmplY3Qua2V5cyhhdWdtZW50ZXJzKS5mb3JFYWNoKGNvbnRlbnRUeXBlID0+IHtcbiAgICBjb25zdCBhdWdtZW50ID0gYXVnbWVudGVyc1tjb250ZW50VHlwZV1cbiAgICBjb25zdCBlbnRpdGllcyA9IGNvbnRlbnRbY29udGVudFR5cGVdXG5cbiAgICBpZiAoIWVudGl0aWVzKSB7XG4gICAgICBjb250ZW50W2NvbnRlbnRUeXBlXSA9IGF1Z21lbnQoe30sIGNvbnRlbnQsIGNvbmZpZylcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGlmICghQXJyYXkuaXNBcnJheShlbnRpdGllcykpIHtcbiAgICAgIGNvbnRlbnRbY29udGVudFR5cGVdID0gYXVnbWVudChlbnRpdGllcywgY29udGVudCwgY29uZmlnKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29udGVudFtjb250ZW50VHlwZV0gPSBlbnRpdGllcy5tYXAoZW50aXR5ID0+IGF1Z21lbnQoZW50aXR5LCBjb250ZW50LCBjb25maWcpKVxuICB9KVxufVxuXG5mdW5jdGlvbiB0cmFuc2Zvcm1Db250ZW50IChjb250ZW50LCB0cmFuc2Zvcm1lck5hbWUpIHtcbiAgY29uc3QgdHJhbnNmb3JtZXJGbiA9IHRyYW5zZm9ybWVyQnlOYW1lKHRyYW5zZm9ybWVyTmFtZSlcbiAgdHJhbnNmb3JtZXJGbihjb250ZW50KVxufVxuXG5mdW5jdGlvbiB0cmFuc2Zvcm1lckJ5TmFtZSAodHJhbnNmb3JtZXJOYW1lKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIHJlcXVpcmUoYC4vY29udGVudC10cmFuc2Zvcm1lcnMvJHt0cmFuc2Zvcm1lck5hbWV9YClcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHRyYW5zZm9ybWVyIFwiJHt0cmFuc2Zvcm1lck5hbWV9XCJgKVxuICB9XG59XG4iXX0=